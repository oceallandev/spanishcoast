<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Original Ref Map | Spanish Coast Properties</title>
  <meta name="robots" content="noindex,nofollow">

  <meta name="theme-color" content="#030712">
  <link rel="manifest" href="manifest.webmanifest?v=20260211a">
  <link rel="stylesheet" href="style.css?v=20260212b">
  <script defer src="i18n.js?v=20260212h"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="config.js?v=20260211a"></script>
  <script defer src="supabase-init.js?v=20260211a"></script>
</head>

<body data-section="account">
  <div class="bg-mesh"></div>

  <header class="main-header glass sticky">
    <div class="header-inner">
      <div class="header-left">
        <div class="logo">
          <a href="index.html" aria-label="Spanish Coast Properties Home">
            <img src="assets/header-logo.png?v=2" alt="Spanish Coast Properties" class="main-logo"
              style="cursor: pointer;">
          </a>
        </div>
        <div class="brand-info">
          <span class="brand-name">Spanish Coast Properties</span>
        </div>
        <nav class="primary-nav" aria-label="Site sections">
          <a class="nav-link" href="account.html">Account</a>
          <a class="nav-link" href="properties.html">Properties</a>
          <a class="nav-link" href="new-builds.html">New Builds</a>
        </nav>
      </div>

      <div class="header-right">
        <a class="header-cta" href="account.html">Back to Account</a>
      </div>
    </div>
  </header>

  <main class="site-main">
    <section class="page-section catalog-section active" aria-label="Original ref map">
      <div class="page-hero">
        <h1>Original Reference Map</h1>
        <p>
          Admin-only tool to populate Supabase <code>public.listing_ref_map</code>.
          This is what powers the <b>Orig</b> button next to <code>SCP-####</code> references across Properties and New
          Builds.
        </p>
      </div>

      <div class="glass panel">
        <div class="admin-toolbar">
          <div class="admin-toolbar-left">
            <div class="muted" id="refmap-auth" aria-live="polite">Checking sessionâ€¦</div>
          </div>
          <div class="admin-toolbar-right">
            <a class="cta-button cta-button--outline" href="account.html?qa=1">Diagnostics</a>
          </div>
        </div>

        <div class="divider"></div>

        <h3 style="margin:0;">Upload a CSV</h3>
        <p class="muted" style="margin-top:0.35rem;">
          CSV columns: <code>scp_ref</code>, <code>source</code>, <code>original_ref</code>, <code>original_id</code>.
          Header row is optional.
        </p>

        <div class="form-grid" style="grid-template-columns: 1fr;">
          <label>
            <span>CSV file</span>
            <input id="refmap-file" class="admin-input" type="file" accept=".csv,text/csv">
          </label>

          <label>
            <span>Or paste CSV</span>
            <textarea id="refmap-paste" class="admin-input" rows="6"
              placeholder="SCP-3000,redsp1,ORIG-REF,ORIG-ID"></textarea>
          </label>
        </div>

        <div class="admin-toolbar" style="margin-top:0.8rem;">
          <div class="admin-toolbar-left">
            <button id="refmap-parse" class="cta-button cta-button--outline" type="button">Parse</button>
            <button id="refmap-import" class="cta-button" type="button" disabled>Import to Supabase</button>
          </div>
          <div class="admin-toolbar-right muted">
            Parsed: <span id="refmap-count">0</span>
          </div>
        </div>

        <div class="muted" id="refmap-status" style="margin-top:0.7rem;" aria-live="polite"></div>

        <div class="divider"></div>

        <h3 style="margin:0;">Preview</h3>
        <p class="muted" style="margin-top:0.35rem;">Shows the first 20 rows that will be imported.</p>
        <div class="admin-table-wrap">
          <table class="admin-table" aria-label="Preview">
            <thead>
              <tr>
                <th>SCP ref</th>
                <th>Source</th>
                <th>Original ref</th>
                <th>Original ID</th>
              </tr>
            </thead>
            <tbody id="refmap-preview-body"></tbody>
          </table>
        </div>

        <div class="divider"></div>

        <h3 style="margin:0;">Lookup</h3>
        <p class="muted" style="margin-top:0.35rem;">
          Quick check to verify that a ref was imported and is readable through RLS.
        </p>
        <div class="admin-toolbar" style="margin-top:0.5rem;">
          <div class="admin-toolbar-left">
            <input id="refmap-lookup-ref" class="admin-input" type="text" placeholder="SCP-3071" style="max-width: 220px;">
            <button id="refmap-lookup-btn" class="cta-button cta-button--outline" type="button">Lookup</button>
          </div>
        </div>
        <pre class="muted" id="refmap-lookup-out"
          style="margin-top:0.6rem; white-space:pre-wrap; background:rgba(0,0,0,0.25); padding:0.8rem; border-radius:12px; min-height:3.2rem;"></pre>
      </div>
    </section>
  </main>

  <script defer src="admin-ref-map.js?v=20260213a"></script>
  <script defer src="site.js?v=20260211e"></script>
</body>

</html>
